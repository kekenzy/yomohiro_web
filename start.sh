#!/bin/bash

# U-è¡—ãƒ—ãƒ©ã‚¶ æ±è¥¿å—åŒ—é¤¨ äºˆç´„ã‚·ã‚¹ãƒ†ãƒ  èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
# ä½¿ç”¨æ–¹æ³•: ./start.sh

echo "ğŸš€ U-è¡—ãƒ—ãƒ©ã‚¶ æ±è¥¿å—åŒ—é¤¨ äºˆç´„ã‚·ã‚¹ãƒ†ãƒ ã‚’èµ·å‹•ã—ã¾ã™..."

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd "$(dirname "$0")"

# ä»®æƒ³ç’°å¢ƒãŒå­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
if [ ! -d "venv" ]; then
    echo "âŒ ä»®æƒ³ç’°å¢ƒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚"
    echo "ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆã—ã¦ãã ã•ã„ï¼š"
    echo "python3 -m venv venv"
    exit 1
fi

# ä»®æƒ³ç’°å¢ƒã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆ
echo "ğŸ“¦ ä»®æƒ³ç’°å¢ƒã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆã—ã¦ã„ã¾ã™..."
source venv/bin/activate

# ä¾å­˜é–¢ä¿‚ã‚’ãƒã‚§ãƒƒã‚¯
if [ ! -f "requirements.txt" ]; then
    echo "âŒ requirements.txtãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚"
    exit 1
fi

# ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
echo "ğŸ“¥ ä¾å­˜é–¢ä¿‚ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã¾ã™..."
pip install -r requirements.txt

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
echo "ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™..."
python manage.py migrate

# é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åé›†
echo "ğŸ“ é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åé›†ã—ã¦ã„ã¾ã™..."
python manage.py collectstatic --noinput

# æ—¢å­˜ã®Djangoã‚µãƒ¼ãƒãƒ¼ã‚’åœæ­¢
echo "ğŸ›‘ æ—¢å­˜ã®Djangoã‚µãƒ¼ãƒãƒ¼ã‚’åœæ­¢ã—ã¦ã„ã¾ã™..."
pkill -f "manage.py runserver" 2>/dev/null || true

# Djangoã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
echo "ğŸŒŸ Djangoã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¦ã„ã¾ã™..."
echo "ğŸ“ ã‚¢ã‚¯ã‚»ã‚¹URL: http://localhost:8001"
echo "ğŸ“ ç®¡ç†ç”»é¢: http://localhost:8001/admin"
echo ""
echo "ğŸ›‘ åœæ­¢ã™ã‚‹ã«ã¯ Ctrl+C ã‚’æŠ¼ã—ã¦ãã ã•ã„"
echo ""

python manage.py runserver 8001
